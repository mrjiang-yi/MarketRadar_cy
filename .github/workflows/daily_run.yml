name: Daily Market Radar (每日市场雷达)

on:
  # 1. 定时触发：每天 UTC 时间 00:00 (北京时间早上 08:00) 运行
  schedule:
    - cron: '0 6 * * *'
  
  # 2. 手动触发：允许你在 GitHub 网页上手动点按钮运行 (方便测试)
  workflow_dispatch:

jobs:
  build:
    runs-on: ubuntu-latest  # 使用最新的 Linux 云端环境

    steps:
    # 第一步：把代码从仓库里拉取下来
    - name: Checkout code
      uses: actions/checkout@v3

    # 第二步：安装 Python 3.12
    - name: Set up Python
      uses: actions/setup-python@v4
      with:
        python-version: '3.12'

    # 第三步：安装 requirements.txt 里的依赖库
    - name: Install dependencies
      run: |
        python -m pip install --upgrade pip
        pip install -r requirements.txt

    # 第四步：运行你的脚本 (关键步骤！)
    - name: Run MarketRadar
      # === 这里的 env 就是把云端的 Secrets 注入到代码的环境变量中 ===
      env:
        SENDER_EMAIL: ${{ secrets.SENDER_EMAIL }}
        SENDER_PASSWORD: ${{ secrets.SENDER_PASSWORD }}
        RECEIVER_EMAIL: ${{ secrets.RECEIVER_EMAIL }}
        # 如果你申请了 FMP Key，也可以在这里加一行:
        # FMP_API_Key: ${{ secrets.FMP_API_KEY }}
      run: python MarketRadar.py