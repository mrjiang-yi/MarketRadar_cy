name: MarketRadar-Daily-Action

on:
  schedule:
    # 每天北京时间 14:00 运行 (UTC 06:00)
    - cron: '0 6 * * *'
  workflow_dispatch:      # 允许手动触发

jobs:
  run-market-radar:
    runs-on: ubuntu-latest

    steps:
    # 1. 拉取代码
    - name: Checkout code
      uses: actions/checkout@v3

    # 2. 设置 Python 环境
    - name: Set up Python
      uses: actions/setup-python@v4
      with:
        python-version: '3.12'

    # 3. 安装依赖
    - name: Install dependencies
      run: |
        python -m pip install --upgrade pip
        if [ -f requirements.txt ]; then pip install -r requirements.txt; fi

    # 4. 执行主程序 (Main)
    - name: Execute MarketRadar Main
      env:
        # 从 GitHub Secrets 中读取敏感信息并注入环境变量
        SENDER_EMAIL: ${{ secrets.SENDER_EMAIL }}
        SENDER_PASSWORD: ${{ secrets.SENDER_PASSWORD }}
        RECEIVER_EMAIL: ${{ secrets.RECEIVER_EMAIL }}
        FMP_API_Key: ${{ secrets.FMP_API_Key }}
        # 【新增】飞书推送 Webhook 地址
        FEISHU_WEBHOOK_URL: ${{ secrets.FEISHU_WEBHOOK_URL }}
      run: |
        python main.py














# name: MarketRadar-Daily-Action

# on:
#   schedule:
#     # 示例：每天 UTC 时间 06:00 (北京时间 14:00) 运行
#     - cron: '0 6 * * *'
#   workflow_dispatch:      # 允许在 GitHub 界面手动点击按钮触发

# jobs:
#   run-market-radar:
#     runs-on: ubuntu-latest

#     steps:
#     # 1. 拉取代码
#     - name: Checkout code
#       uses: actions/checkout@v3

#     # 2. 设置 Python 环境
#     - name: Set up Python
#       uses: actions/setup-python@v4
#       with:
#         python-version: '3.12'  # 推荐使用 3.12 或更高版本

#     # 3. 安装依赖
#     - name: Install dependencies
#       run: |
#         python -m pip install --upgrade pip
#         if [ -f requirements.txt ]; then pip install -r requirements.txt; fi

#     # 4. 执行主程序 (Main)
#     - name: Execute MarketRadar Main
#       env:
#         # 从 GitHub Secrets 中读取敏感信息并注入环境变量
#         SENDER_EMAIL: ${{ secrets.SENDER_EMAIL }}
#         SENDER_PASSWORD: ${{ secrets.SENDER_PASSWORD }}
#         RECEIVER_EMAIL: ${{ secrets.RECEIVER_EMAIL }}
#         FMP_API_Key: ${{ secrets.FMP_API_Key }}  # 如果你使用了FMP数据源
#       run: |
#         python main.py
